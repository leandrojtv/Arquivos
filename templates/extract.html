{% extends "base.html" %}
{% block title %}Extração de metadados{% endblock %}
{% block content %}
<section class="form-section">
  <div class="section-header">
    <div>
      <p class="eyebrow">Pipelines</p>
      <h2>Extração de metadados</h2>
      <p class="subtitle">Configure conectores e dispare fluxos em etapas para preencher as bases direto da fonte.</p>
    </div>
  </div>
  <div class="grid-two">
    <a class="card action-card" href="{{ url_for('extract_teradata') }}">
      <div class="icon-circle"><svg class="icon"><use href="#icon-satellite"></use></svg></div>
      <div>
        <p class="eyebrow">Teradata</p>
        <h3>Extrair metadados</h3>
        <p>Fluxo guiado para montar o JDBC, testar conexão e aplicar o catálogo diretamente nas bases.</p>
      </div>
      <span class="pill">Metadados</span>
    </a>
    <div class="card action-card disabled">
      <div class="icon-circle"><svg class="icon"><use href="#icon-plug"></use></svg></div>
      <div>
        <p class="eyebrow">Em breve</p>
        <h3>Outros conectores</h3>
        <p>Reservado para futuros bancos e ferramentas de profiling.</p>
      </div>
      <span class="pill">Bloqueado</span>
    </div>
  </div>
  <div class="card table-card">
    <div class="table-header">
      <div>
        <p class="eyebrow">Resources</p>
        <h3>Configurações salvas</h3>
        <p class="subtitle">Edite um resource existente ou execute para gerar um novo job.</p>
      </div>
      <div class="actions-row">
        <a class="btn ghost" href="{{ url_for('extract_teradata') }}"><svg class="icon"><use href="#icon-plus"></use></svg><span>Novo resource</span></a>
      </div>
    </div>
    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>Nome</th>
            <th>Conector</th>
            <th>Modo</th>
            <th>Schedule</th>
            <th class="text-right">Ações</th>
          </tr>
        </thead>
        <tbody>
          {% if resources %}
            {% for res in resources %}
            <tr>
              <td>{{ res['name'] }}</td>
              <td>{{ res['connector']|capitalize }}</td>
              <td>{{ res['mode']|capitalize }}</td>
              <td>
                {% if res['run_once'] %}
                  Único
                {% elif res['schedule_id'] and schedules.get(res['schedule_id']) %}
                  {{ schedules[res['schedule_id']]['name'] }}<br>
                  <span class="muted">Próx: {{ res['next_run_at'] or '—' }}</span>
                {% else %}
                  —
                {% endif %}
              </td>
              <td class="text-right">
                <div class="table-actions compact">
                  <form method="post" action="{{ url_for('run_resource', resource_id=res['id']) }}" class="inline">
                    <button type="submit" class="btn ghost"><svg class="icon"><use href="#icon-play"></use></svg><span>Executar</span></button>
                  </form>
                  <a class="btn ghost" href="{{ url_for('extract_teradata', resource_id=res['id']) }}"><svg class="icon"><use href="#icon-edit"></use></svg><span>Editar</span></a>
                </div>
              </td>
            </tr>
            {% endfor %}
          {% else %}
            <tr><td colspan="5" class="muted">Nenhum resource configurado ainda.</td></tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>
</section>
{% endblock %}
