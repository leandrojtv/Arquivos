<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}Gestão de Bases e Gestores{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
  </head>
  <body class="app-shell">
    <div class="dashboard-shell {% if session.get('user') %}has-sidebar sidebar-open{% endif %}">
      {% if session.get('user') %}
      <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
          <div class="brand">
            <div class="brand-icon">DB</div>
            <div>
              <p class="eyebrow">Console</p>
              <h2>Gestão</h2>
            </div>
          </div>
          <button class="icon-button ghost close-sidebar" type="button" aria-label="Fechar menu" data-target="sidebar">
            <svg class="icon"><use href="#icon-close"></use></svg>
          </button>
        </div>
        <div class="sidebar-actions">
          <button type="button" class="button nav-button primary open-modal nav-new" data-target="novo-modal">
            <svg class="icon"><use href="#icon-plus"></use></svg><span>Novo</span>
          </button>
        </div>
        <nav class="main-nav open" id="main-menu">
          <a class="button nav-button ghost" href="{{ url_for('landing') }}"><svg class="icon"><use href="#icon-home"></use></svg><span>Início</span></a>
          <a class="button nav-button ghost" href="{{ url_for('list_bases') }}"><svg class="icon"><use href="#icon-database"></use></svg><span>Bases</span></a>
          <a class="button nav-button ghost" href="{{ url_for('list_gestors') }}"><svg class="icon"><use href="#icon-users"></use></svg><span>Gestores</span></a>
          <a class="button nav-button ghost" href="{{ url_for('search') }}"><svg class="icon"><use href="#icon-search"></use></svg><span>Pesquisar</span></a>
          <a class="button nav-button ghost" href="{{ url_for('import_records') }}"><svg class="icon"><use href="#icon-upload"></use></svg><span>Importar</span></a>
          <a class="button nav-button ghost" href="{{ url_for('reports') }}"><svg class="icon"><use href="#icon-chart"></use></svg><span>Relatórios</span></a>
          <a class="button nav-button ghost" href="{{ url_for('extraction_menu') }}"><svg class="icon"><use href="#icon-satellite"></use></svg><span>Extração</span></a>
        </nav>
        <div class="sidebar-footer">
          <p class="muted">Layout inspirado no template Vue.js admin da Cruip.</p>
        </div>
      </aside>
      {% endif %}

      <div class="workspace">
        <header class="site-header">
          <div class="page-grid header-main">
            {% if session.get('user') %}
            <button class="menu-toggle ghost" type="button" aria-expanded="false" aria-controls="sidebar">
              <svg class="icon"><use href="#icon-menu"></use></svg>
            </button>
            {% endif %}
            <div class="page-title">
              <p class="eyebrow">Painel</p>
              <h1>Cadastro de Bases e Gestores</h1>
              <p class="subtitle">Registre responsáveis, ambientes e detalhes das bases.</p>
            </div>
            {% if session.get('user') %}
            <div class="user-menu" tabindex="0">
              <div class="user-trigger">
                <div class="avatar">{{ session.get('user')[0]|upper }}</div>
                <span class="user-name">{{ session.get('user') }}</span>
                <span class="chevron">▾</span>
              </div>
              <div class="user-dropdown">
                <a href="{{ url_for('settings') }}">Configurações</a>
                <a href="{{ url_for('schedules') }}">Schedules</a>
                <a href="{{ url_for('monitor_jobs') }}">Jobs de extração</a>
                <a href="{{ url_for('logout') }}">Sair</a>
              </div>
            </div>
            {% else %}
            <a href="{{ url_for('login') }}" class="pill">Login</a>
            {% endif %}
          </div>
        </header>
    {% if session.get('user') %}
    <div class="modal-overlay" id="novo-modal" aria-hidden="true">
      <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="novo-title">
        <header class="modal-header">
          <div>
            <p class="eyebrow">Novo</p>
            <h3 id="novo-title">O que deseja cadastrar?</h3>
            <p class="subtitle">Escolha se quer criar um gestor ou uma base.</p>
          </div>
          <button type="button" class="icon-button close-modal" data-target="novo-modal" aria-label="Fechar"><svg class="icon"><use href="#icon-close"></use></svg></button>
        </header>
        <div class="modal-actions">
          <a class="button" href="{{ url_for('new_gestor_form') }}"><svg class="icon"><use href="#icon-user"></use></svg><span>Novo gestor</span></a>
          <a class="button secondary" href="{{ url_for('new_base_form') }}"><svg class="icon"><use href="#icon-database"></use></svg><span>Nova base</span></a>
        </div>
        <button type="button" class="button ghost full close-modal" data-target="novo-modal"><svg class="icon"><use href="#icon-arrow-left"></use></svg><span>Cancelar</span></button>
      </div>
    </div>
    {% endif %}
    <main class="page-area">
      <div class="page-grid">
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            <ul class="messages">
              {% for category, message in messages %}
                <li class="{{ category }}">{{ message }}</li>
              {% endfor %}
            </ul>
          {% endif %}
        {% endwith %}
        {% block content %}{% endblock %}
      </div>
    </main>
      </div>
    </div>
    {% if session.get('user') %}
      <script>
        const shell = document.querySelector('.dashboard-shell');
        const sidebar = document.getElementById('sidebar');
        const menuToggle = document.querySelector('.menu-toggle');
        const isMobile = () => window.innerWidth <= 1024;

        const setSidebarState = (open) => {
          if (!shell) return;
          shell.classList.toggle('sidebar-open', open);
          if (menuToggle) menuToggle.setAttribute('aria-expanded', open ? 'true' : 'false');
        };

        const toggleModal = (targetId, open) => {
          const el = document.getElementById(targetId);
          if (!el) return;
          if (open) {
            el.classList.add('open');
            el.setAttribute('aria-hidden', 'false');
          } else {
            el.classList.remove('open');
            el.setAttribute('aria-hidden', 'true');
          }
        };

        document.addEventListener('click', (event) => {
          const openTrigger = event.target.closest('.open-modal');
          if (openTrigger) {
            toggleModal(openTrigger.dataset.target, true);
          }
          const closeTrigger = event.target.closest('.close-modal');
          if (closeTrigger) {
            toggleModal(closeTrigger.dataset.target, false);
          }
          const overlay = event.target.classList.contains('modal-overlay') ? event.target : null;
          if (overlay) {
            toggleModal(overlay.id, false);
          }

          if (isMobile() && shell?.classList.contains('sidebar-open') && sidebar && menuToggle) {
            if (!sidebar.contains(event.target) && !menuToggle.contains(event.target)) {
              setSidebarState(false);
            }
          }
        });

        document.addEventListener('keydown', (event) => {
          if (event.key === 'Escape') {
            document.querySelectorAll('.modal-overlay.open').forEach((el) => toggleModal(el.id, false));
            if (isMobile()) setSidebarState(false);
          }
        });

        if (menuToggle && sidebar && shell) {
          setSidebarState(!isMobile());
          menuToggle.addEventListener('click', () => {
            if (isMobile()) {
              setSidebarState(!shell.classList.contains('sidebar-open'));
            }
          });

          window.addEventListener('resize', () => {
            setSidebarState(!isMobile());
          });
        }

        document.querySelectorAll('.close-sidebar').forEach((btn) => {
          btn.addEventListener('click', () => {
            const target = document.getElementById(btn.dataset.target);
            if (target) target.classList.remove('open');
            setSidebarState(false);
          });
        });
    </script>
    {% endif %}
    <svg xmlns="http://www.w3.org/2000/svg" style="display:none">
      <symbol id="icon-home" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <path d="M4.5 10.5 12 4l7.5 6.5V20a1 1 0 0 1-1 1h-4.5v-5a2.5 2.5 0 0 0-5 0v5H5.5a1 1 0 0 1-1-1z"/>
      </symbol>
      <symbol id="icon-database" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <ellipse cx="12" cy="6" rx="6.5" ry="3.25"/>
        <path d="M5.5 6v6c0 1.8 2.9 3.25 6.5 3.25s6.5-1.45 6.5-3.25V6"/>
        <path d="M5.5 12v6c0 1.8 2.9 3.25 6.5 3.25s6.5-1.45 6.5-3.25v-6"/>
      </symbol>
      <symbol id="icon-users" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <path d="M16 14a3.5 3.5 0 1 1 3.5-3.5"/>
        <path d="M4.5 17.25c0-2.07 3.36-3.75 7.5-3.75s7.5 1.68 7.5 3.75c0 1.6-2.4 3-7.5 3s-7.5-1.4-7.5-3Z"/>
        <circle cx="9" cy="8.5" r="3.5"/>
      </symbol>
      <symbol id="icon-user" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="7" r="4"/>
        <path d="M5 19c0-2.5 3.1-4.5 7-4.5s7 2 7 4.5"/>
      </symbol>
      <symbol id="icon-user-search" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="10.5" cy="7" r="3.5"/>
        <path d="M4.5 18c0-2.2 2.8-4 6-4 .8 0 1.6.1 2.3.3"/>
        <circle cx="16" cy="15.5" r="3"/>
        <path d="m18.5 18 2.5 2.5"/>
      </symbol>
      <symbol id="icon-search" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="11" cy="11" r="5.5"/>
        <path d="m15.5 15.5 4 4"/>
      </symbol>
      <symbol id="icon-filter" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <path d="M4 6h16M7 12h10M10 18h4"/>
      </symbol>
      <symbol id="icon-upload" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <path d="M12 4v12"/>
        <path d="m8 8 4-4 4 4"/>
        <path d="M5 16v2a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-2"/>
      </symbol>
      <symbol id="icon-download" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <path d="M12 20V8"/>
        <path d="m16 16-4 4-4-4"/>
        <path d="M5 6V4h14v2"/>
      </symbol>
      <symbol id="icon-export" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <path d="M12 5v11"/>
        <path d="m8.5 8.5 3.5-3.5 3.5 3.5"/>
        <path d="M6 13.5V19h12v-5.5"/>
      </symbol>
      <symbol id="icon-chart" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <path d="M5 20V9"/>
        <path d="M12 20V4"/>
        <path d="M19 20v-8"/>
        <path d="M4 20h16"/>
      </symbol>
      <symbol id="icon-grid" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <path d="M10 4H5a1 1 0 0 0-1 1v5h6zM19 4h-5v6h6V5a1 1 0 0 0-1-1zM10 14H4v5a1 1 0 0 0 1 1h5zM14 14v6h5a1 1 0 0 0 1-1v-5z"/>
      </symbol>
      <symbol id="icon-stack" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <path d="m4 9 8-4 8 4-8 4z"/>
        <path d="m6.5 12 5.5 2.75L17.5 12"/>
        <path d="m6.5 15.5 5.5 2.75 5.5-2.75"/>
      </symbol>
      <symbol id="icon-satellite" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <path d="M10 14.5 7 17.5 3 13.5l3-3L10 14.5l2-2"/>
        <path d="m14 10 3-3 4 4-3 3-4-4z"/>
        <circle cx="12" cy="12" r="1.8"/>
        <path d="m16.5 5.5-2.5-2.5M21 10l2.5 2.5"/>
      </symbol>
      <symbol id="icon-plus" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <path d="M12 5v14M5 12h14"/>
      </symbol>
      <symbol id="icon-menu" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <path d="M4 7h16M4 12h16M4 17h16"/>
      </symbol>
      <symbol id="icon-close" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <path d="M6 6l12 12M18 6 6 18"/>
      </symbol>
      <symbol id="icon-arrow-left" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <path d="M14 6 8 12l6 6"/>
      </symbol>
      <symbol id="icon-arrow-right" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <path d="m10 6 6 6-6 6"/>
      </symbol>
      <symbol id="icon-save" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <path d="M6 4h10l4 4v10a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2Z"/>
        <path d="M12 4v6"/>
        <rect x="8" y="14" width="8" height="6" rx="1"/>
      </symbol>
      <symbol id="icon-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <path d="m5.5 12 4 4L18.5 7"/>
      </symbol>
      <symbol id="icon-edit" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <path d="M13.5 6.5 17.5 10.5M5 19l4.75-1.1a1 1 0 0 0 .47-.27l8.28-8.28a2 2 0 0 0 0-2.83l-.02-.02a2 2 0 0 0-2.83 0l-8.3 8.3a1 1 0 0 0-.26.47z"/>
      </symbol>
      <symbol id="icon-trash" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <path d="M5 7h14"/>
        <path d="M9 7V5.5A1.5 1.5 0 0 1 10.5 4h3A1.5 1.5 0 0 1 15 5.5V7"/>
        <path d="M18 7v11a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V7"/>
      </symbol>
      <symbol id="icon-lab" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <path d="M9 4h6"/>
        <path d="M10 4v5.5L6.5 17a3 3 0 0 0 2.6 4.5h5.8a3 3 0 0 0 2.6-4.5L14 9.5V4"/>
      </symbol>
      <symbol id="icon-calendar" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <rect x="4" y="6" width="16" height="14" rx="2"/>
        <path d="M8 4v4M16 4v4M4 11h16"/>
      </symbol>
      <symbol id="icon-rocket" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <path d="M7 15.5 4.5 18l2.5.5L8 21l2.5-2.5"/>
        <path d="M9.5 14.5 16 8c1.5-1.5 4-4 4-4s-2.5 0-4 1.5l-6.5 6.5a6 6 0 0 0-1.5 2.7l-.5 2.8 2.8-.5a6 6 0 0 0 2.7-1.5z"/>
        <circle cx="15" cy="9" r="1.3"/>
      </symbol>
      <symbol id="icon-flag" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <path d="M6 4v16"/>
        <path d="M6 5h9l-1.5 3H20l-1.5 3H6"/>
      </symbol>
      <symbol id="icon-repeat" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <path d="M17 7H7l2-2"/>
        <path d="M7 17h10l-2 2"/>
        <path d="M17 7a4 4 0 0 1 4 4v2M7 17a4 4 0 0 1-4-4v-2"/>
      </symbol>
      <symbol id="icon-link" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <path d="M9.5 14.5 8 16a4 4 0 1 1 0-5.66l1.5-1.5"/>
        <path d="M14.5 9.5 16 8a4 4 0 1 1 0 5.66l-1.5 1.5"/>
        <path d="M9 12h6"/>
      </symbol>
      <symbol id="icon-doc" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <path d="M7 4h7l4 4v12a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1Z"/>
        <path d="M14 4v4h4"/>
      </symbol>
      <symbol id="icon-lock" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <rect x="5" y="11" width="14" height="9" rx="2"/>
        <path d="M9 11V8a3 3 0 0 1 6 0v3"/>
      </symbol>
      <symbol id="icon-refresh" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <path d="M5 11V6h5"/>
        <path d="M19 13v5h-5"/>
        <path d="M5 6a8 8 0 0 1 12 1.1M19 18a8 8 0 0 1-12-1.1"/>
      </symbol>
      <symbol id="icon-compass" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="9"/>
        <path d="m10 10 6-3-3 6-6 3z"/>
      </symbol>
      <symbol id="icon-calendar-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <use href="#icon-calendar" />
        <path d="m9 13.5 2 2 4-4"/>
      </symbol>
      <symbol id="icon-plug" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <path d="M9 5v5m6-5v5"/>
        <path d="M7 10h10v2a5 5 0 0 1-5 5 5 5 0 0 1-5-5z"/>
        <path d="M12 17v3"/>
      </symbol>
    </svg>
  </body>
</html>
